openapi: 3.0.2
info:
  version: 1.0.0
  title: BlackLotus
  description: "POR PONER"
servers:
  - url: 'http://127.0.0.1:8000/'
paths:
  /issues/:
    get:
      tags:
      - Issues
      summary: Finds all the issues
      operationId: getIssues
      parameters:
      - name: name
        in: query
        description: Optional name of the issue
        required: false
        schema:
          type: string
      - name: sort
        in: query
        description: Optional parameter of sorting of the issue
        required: false
        schema:
          type: string
      - name: order
        in: query
        description: Optional order of sorting of the issue
        required: false
        schema:
          type: string
      responses:
        200:
          description: successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Issue'

  /issue/{id}/:
    get:
      tags:
      - Issues
      summary: Finds an issue with its id, if it's id
      operationId: getIssueById
      parameters:
      - name: id
        in: path
        description: Compulsory id of the issue
        required: true
        schema:
          type: integer
      responses:
        200:
          description: successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Issue'
        400:
          description: 'Error: Bad Request'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
              examples:
                errorExample:
                  $ref: '#/components/examples/error400'
        401:
          description: 'Error: Unauthorized'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
              examples:
                errorExample:
                  $ref: '#/components/examples/error401'
        403:
            description: 'Error: Forbidden'
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/ErrorResult'
                examples:
                  errorExample:
                    $ref: '#/components/examples/error403'
    put:
      tags:
        - Issues
      summary: Delete a watcher of an issue
      parameters:
      - name: id
        in: path
        description: Id of the issue which deadline you want to delete.
        required: true
        schema:
          type: integer
      - name: watcher
        in: query
        description: Name of the user you want to remove from the watcher.
        required: true
        schema:
          type: string

      responses:
        200:
          description: 'Watchers updated'
          content:
            application/json:
                schema:
                  $ref: '#/components/schemas/ErrorResult'
                examples:
                  errorExample:
                    $ref: '#/components/examples/code200Deadline'
        404:
          description: 'Error: Not Found'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
              examples:
                errorExample:
                  $ref: '#/components/examples/error404noIssue'
        401:
          description: 'Error: Unauthorized'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
              examples:
                errorExample:
                  $ref: '#/components/examples/error401'
        403:
            description: 'Error: Forbidden'
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/ErrorResult'
                examples:
                  errorExample:
                    $ref: '#/components/examples/error403'

        406:
            description: 'Error: Not Accepted'
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/ErrorResult'
                examples:
                  errorExample:
                    $ref: '#/components/examples/error406badFormat'

  /issue/{id}/attachment:
    post:
      tags:
        - Attachments
      summary: Adds an Attachment to an Issue
      operationId: addAttachment
      parameters:
      - name: id
        in: path
        description: Id of the issue
        required: true
        schema:
          type: integer
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                upfile:
                  type: string
                  format: binary
                  description: The file to upload.

      responses:
        200:
          description: successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Issue'

  /activity/:
    get:
      tags:
      - Activities
      summary: List all the activities of an issue
      operationId: getActivitiesOfIssue
      parameters:
      - name: id
        in: query
        description: Id of the issue
        required: true
        schema:
          type: integer
      responses:
        200:
          description: successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Activity'
        400:
          description: 'Error: Bad Request'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
              examples:
                errorExample:
                  $ref: '#/components/examples/error400'
        401:
          description: 'Error: Unauthorized'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
              examples:
                errorExample:
                  $ref: '#/components/examples/error401'
        403:
            description: 'Error: Forbidden'
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/ErrorResult'
                examples:
                  errorExample:
                    $ref: '#/components/examples/error403'
  /profile/{username}/:
    get:
      tags:
      - Profiles
      summary: Get the profile of a user
      operationId: getProfileOfUser
      parameters:
      - name: username
        in : path
        description: Username of the profile
        required: true
        schema:
          type: string

      responses:
        200:
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Profile'
        404:
          description: 'Error: Not Found'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
              examples:
                errorExample:
                  $ref: '#/components/examples/error404noProfile'
        400:
          description: 'Error: Bad Request'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
              examples:
                errorExample:
                  $ref: '#/components/examples/error400'
        401:
          description: 'Error: Unauthorized'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResult'
              examples:
                errorExample:
                  $ref: '#/components/examples/error401'
        403:
            description: 'Error: Forbidden'
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/ErrorResult'
                examples:
                  errorExample:
                    $ref: '#/components/examples/error403'
    put:
      tags:
        - Profiles
      summary: Edit a profile by the username
      parameters:
      - name: username
        in : path
        description: Username of the profile
        required: true
        schema:
          type: string
      - name: bio
        in : query
        description: New biography of the profile
        required: false
        schema:
          type: string
      - name: image
        in : query
        description: New url of the profile image
        required: false
        schema:
          type: string
      - name: email
        in : query
        description: New email of the profile
        required: false
        schema:
          type: string
      - name: first_name
        in : query
        description: New name of the profile
        required: false
        schema:
          type: string
      responses:
        200:
          description: 'Profile updated'
          content:
            application/json:
                schema:
                  $ref: '#/components/schemas/ErrorResult'
                examples:
                  errorExample:
                    $ref: '#/components/examples/code200putProfile'

components:
  securitySchemes:
    ApiKeyAuth:
        type: apiKey
        in: header
        name: Authorization
  schemas:
    User:
      type: object
      properties:
        id:
            type: integer
            format: int64
            example: 2
        username:
            type: string
            minLength: 4
            example: 'TestSubject'

    Profile:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 2
        bio:
          type: string
          example: 'Hello World'
        image:
          type: string
          example: '/Images/drilo.jpg'


    Activity:
      type: object
      properties:
        creationdate:
          type: string
          format: date-time
        field:
          type: string
          minLength: 4
          example: 'status'
        change:
          type: string
          minLength: 4
          example: 'In progress'
        old:
          type: string
          minLength: 4
          example: 'New'
        user:
          $ref: '#/components/schemas/User'

        issueChanged:
          $ref: '#/components/schemas/Issue'

        _links:
          type: object
          properties:
            self:
              type: string
              format: url
              example: 'http://127.0.0.1:8000/api/Activity/?Activity=1'


    Issue:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 2
        subject:
          type: string
          minLength: 4
          example: 'TestSubject'
        description:
          type: string
          minLength: 4
          maxLength: 100
          example: 'My content'
        creator:
          type: string
          minLength: 4
          maxLength: 100
          example: 'LluisPetardo'
        creationdate:
          type: string
          format: date-time
        modifieddate:
          type: string
          format: date-time
        deadlinedate:
          type: string
          format: date-time
        deadlinemotive:
          type: string
          minLength: 4
          maxLength: 100
          example: 'PQ_LluisPetardo'
        blocked:
          type: boolean
        blockmotiv*e:
          type: string
          minLength: 4
          maxLength: 100
          example: 'PQ_LluisPetardo'
        deadline:
          type: boolean
        status:
          type: integer
          format: int64
          example: 2
        type:
          type: integer
          format: int64
          example: 2
        severity:
          type: integer
          format: int64
          example: 2
        priority:
          type: integer
          format: int64
          example: 2
        watchers:
          type: array
          items:
            $ref: '#/components/schemas/User'
        asignedTo:
          type: array
          items:
            $ref: '#/components/schemas/User'
        _links:
          type: object
          properties:
            self:
              type: string
              format: url
              example: 'http://127.0.0.1:8000/api/Issue/?Issue=1'

    ErrorResult:
      type: object
      properties:
        message:
          type: string
          example: 'Content is too long (maximum is 280 characters)'
      required:
        - message

  examples:
    code200putProfile:
      value:
        message: "Profile update complete"
    error400:
      value:
        message: "Content is too long (maximum is 280 characters)"
    error401:
      value:
        message: "You provided no token"
    error403:
      value:
        message: "You provided an invalid token"
    error404noProfile:
      value:
        message: "There is no profile with this username"
    error404noIssue:
      value:
        message: "Issue not found"
    error406badFormat:
      value:
        message: "Format is not correct"
    code200Deadline:
      value:
        message: "Deadline deleted"

security:
  - ApiKeyAuth: []